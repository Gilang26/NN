<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>LayerZero Manual Redeem</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<style>
body{background:#0b1220;color:#e6edf3;font-family:system-ui,Arial;margin:0;display:grid;place-items:center;min-height:100vh}
.card{width:min(720px,95vw);background:#121a2a;border:1px solid #22304a;border-radius:12px;padding:18px}
input,button{width:100%;padding:12px;border-radius:10px;margin-top:8px;font-size:14px}
input{border:1px solid #22304a;background:#0f1625;color:#fff}
button{border:0;background:linear-gradient(90deg,#6ee7ff,#7c5cff);color:#06101a;font-weight:700;cursor:pointer}
pre{white-space:pre-wrap;background:#0f1625;border:1px solid #22304a;border-radius:10px;padding:10px;margin-top:10px;min-height:90px}
.row{display:flex;gap:8px;flex-wrap:wrap}.row>*{flex:1}
</style>
</head>
<body>
<div class="card">
  <h2>ğŸŒ LayerZero Manual Redeem</h2>
  <div class="row">
    <input id="srcEid" value="30101" />
    <input id="executor" value="0xab329959fe048721cdf7f13a3eb43e4fc549a9de1adb90d393701583c4b11f79" />
  </div>
  <input id="sender32" value="0x000000000000000000000000cc1ae8cf5d3904cef3360a9532b477529b177cce" />
  <input id="payload"  value="0x0000000000000000000000004d02af17a29cda77416a1f60eae9092bb6d9c02600038d7ea4c68000" />
  <div class="row">
    <button id="connect">ğŸ”Œ Connect</button>
    <button id="redeem">ğŸš€ Send lzReceive()</button>
  </div>
  <pre id="log">log siap...</pre>
</div>

<script>
const $=id=>document.getElementById(id);
const log=m=>{const el=$("log");el.textContent+=(el.textContent?"\n":"")+m;el.scrollTop=el.scrollHeight;console.log(m);};
const LZ_ABI=["function lzReceive(uint32,bytes32,bytes,address) external"];

let provider,signer,me;

async function connect(){
  try{
    if(!window.ethereum) throw new Error("Buka dengan MetaMask/OKX/Trust.");
    provider=new ethers.providers.Web3Provider(window.ethereum,"any");
    await provider.send("eth_requestAccounts",[]);
    signer=provider.getSigner();
    me=await signer.getAddress();
    const net=await provider.getNetwork();
    log(`âœ… Connected: ${me}\nChain: ${net.chainId}`);
  }catch(e){ log("âŒ Connect error: "+(e.message||e)); }
}

async function redeem(){
  try{
    const srcEid = Number($("srcEid").value.trim());
    const sender = $("sender32").value.trim();
    const payload= $("payload").value.trim();
    const exec   = ethers.utils.getAddress($("executor").value.trim());

    if(!/^0x[0-9a-fA-F]{64}$/.test(sender)) return log("âš ï¸ sender32 harus 32-byte hex.");
    if(!/^0x[0-9a-fA-F]+$/.test(payload))   return log("âš ï¸ payload harus hex 0xâ€¦");

    const c = new ethers.Contract(exec, LZ_ABI, signer);
    log("ğŸš€ Calling lzReceive()â€¦");
    const tx = await c.lzReceive(srcEid, sender, payload, exec, { gasLimit: 600000 });
    log(`â³ TX: ${tx.hash}`);
    const rc = await tx.wait();
    log(`âœ… Delivered at block ${rc.blockNumber}`);
  }catch(e){
    log("âŒ Redeem error: "+(e.data?.message||e.error?.message||e.reason||e.message||String(e)));
  }
}

$("connect").onclick=connect;
$("redeem").onclick=redeem;
</script>
</body>
</html>
